

## ✅ 범위/원칙

- **입력**: `specs/FRS-n.md`
    
- **출력**: 서비스 타입(`api`/`web`)별 아래 4+1개 산출물
    
    - `requirements.md`
        
    - `design.md`
        
    - `tasks.md`
        
    - `changes.md`
        
    - `apis.json`(※ `api`일 때만)
        
- **규칙**: RAG 사용 **없음**(외부 용어집/Apidog 미의존), 결정적(규칙/템플릿) 생성 중심
    
- **일관 포맷**: 모든 문서는 동일 템플릿 섹션 구조를 강제, 누락 시 `<!-- WARN: ... -->`로 표시
    

## ✅ 프롬프트 실행 흐름 (확정)

1. **입력(FRS) → 요구사항**
    
    - “**FRS-n을 requirements.md로 변환해줘.**”
        
    - 결과: `requirements.md`
        
2. **연계 실행**
    
    - “**requirements.md를 기반으로 design.md 생성해줘.**”
        
    - “**design.md를 기반으로 tasks.md 생성해줘.**”
        
    - “**requirements.md + design.md로 changes.md 생성해줘.**”
        
    - “**requirements.md + design.md로 apis.json 생성해줘.**” _(api 전용)_
        

## ✅ 산출 저장 경로 (확정)

`specs/   FRS-n/     api/|web/       requirements.md       design.md       tasks.md       changes.md       apis.json   # api만 생성`

## ✅ 문서 템플릿(섹션 고정)

- **requirements.md**
    
    - Header/Meta → Scope(In/Out) → Functional Requirements(FR-*) → Error Requirements → Security & Privacy → Observability(OTel 포인트 명시 권장) → Acceptance Criteria(Gherkin 체크리스트)
        
- **design.md**
    
    - Architecture(구성요소/미들웨어) → Sequence Diagram(필수) → Data Model(핵심 엔티티/인덱스 요지) → API 계약 요약 → Security & Permissions(RBAC/토큰 정책) → Performance Goals/KPIs
        
- **tasks.md**
    
    - Epic/Story/Task 표(Owner/SP/Depends) ≥ 최소 Story 2+, Task 5+ → DoD(품질 기준)
        
- **changes.md**
    
    - Version History → Change Summary → Impact/Risk → Rollback Plan → Known Issues
        
- **apis.json (OpenAPI 3.1)**
    
    - `info/servers/tags/securitySchemes/paths/components(schemas,responses,examples)`
        

## ✅ 품질 게이트(생성 직후 자동 점검)

- **Markdown**: 필수 섹션 누락 검사, 링크 체크
    
- **OpenAPI**: 스키마 유효성(lint) — `apis.json` 있을 때
    
- **경고 처리**: 문서 내 `<!-- WARN: ... -->` + 요약 리포트(JSON) 생성(옵션)
    

## ✅ 브랜치/커밋(권장)

- 브랜치: `specgen/scenario-3/<frs-id>-<service>`
    
- 커밋 메시지 예: `spec(#frs-n): add <service> spec docs`
    
- PR 본문: 산출물 목록 + 품질 게이트 결과 요약
    

## ✅ 예외 처리(요지)

- FRS 파싱 애매/누락: 해당 섹션 생성하되 `WARN` 주석 표시
    
- API 스키마 추출 곤란: `paths` 스켈레톤만 생성 + `WARN`
    
- 파일 충돌: 전용 브랜치에서 커밋 후 PR로 해결
    

---

필요하면, 이 확정 흐름에 맞춰 **표준 프롬프트 셋**(복붙용)과 **품질 게이트 스크립트**(markdownlint/spectral)도 바로 내려드릴게요.

##### 나의 말:

구현은 Strand Agents로 진행하려고해 이 부분을 반영해줘 참고할 수 있는 requirements.txt야 strands-agents[a2a,openai] strands-agents-tools

###### ChatGPT의 말:

좋아요—**시나리오 3**를 **Strands Agents**로 구현하는 방향으로 바로 반영해서 정리해드릴게요. 아래 내용은 지금 확정된 프롬프트 실행 흐름(입력 FRS → requirements → design → tasks → changes → apis.json) 그대로를 Strands A2A 플로우로 옮긴 **실행 설계 + 최소 코드 스켈레톤**입니다.

# 0) 환경 및 의존성

`requirements.txt` (확정)

`strands-agents[a2a,openai] strands-agents-tools`

- 모델: OpenAI(사내 OpenAI 프록시/키 사용 가능)
    
- Agent 오케스트레이션: **A2A(Agent-to-Agent)** 체인
    
- 목적: **동일 포맷의 문서 4+1종**을 순차 산출하고, 파일 시스템/깃 라이터는 별도 툴로 분리
    

---

# 1) 에이전트 역할(역할·입출력·책임)

|Agent|역할|입력|출력|특기사항|
|---|---|---|---|---|
|**FRSLoader** (Tool Agent)|FRS 원문 로딩|repo/ref/path or raw text|`frs_md`|초기 PoC에선 파일시스템/HTTP 로더로 대체 가능|
|**ReqsAgent**|`requirements.md` 생성|`frs_md`|`requirements.md`|템플릿 섹션 강제, 누락시 `<!-- WARN: ... -->`|
|**DesignAgent**|`design.md` 생성|`requirements.md`|`design.md`|Sequence 다이어그램 블록 포함(마크다운)|
|**TasksAgent**|`tasks.md` 생성|`design.md`|`tasks.md`|Epic/Story/Task ≥ 최소 기준 강제|
|**ChangesAgent**|`changes.md` 생성|`requirements.md + design.md`|`changes.md`|Version/Impact/Rollback/Issues 고정 섹션|
|**OpenAPIAgent** (api만)|`apis.json` 생성|`requirements.md + design.md`|`apis.json`|OpenAPI 3.1, paths/components 필수|
|**QCInspector** (옵션)|품질 게이트|위 4(+1) 산출물|`_quality/report.json`|markdownlint/spectral 결과 요약|
|**RepoWriter** (Tool Agent)|저장/커밋|파일 리스트, 경로|커밋 SHA|GitHub MCP/내부 게이트웨이 중 택1 (후술)|

> 시나리오 3에서는 **RAG 없음** (외부 용어집/Apidog 배제). 모든 Agent는 **결정적 템플릿 중심 프롬프트**를 사용.

---

# 2) Strands A2A 플로우(그래프)

논리 흐름:

`FRSLoader → ReqsAgent → DesignAgent → (TasksAgent, ChangesAgent) → [OpenAPIAgent if api] → QCInspector → RepoWriter`

Strands 의사코드(파이썬 스켈레톤):

```python
from strands import Agent, Strand, a2a
from strands.tools import FileTool  # 예시; 실제로는 RepoWriter/FRSLoader 커스텀

FRSLoader = Agent(
    name="FRSLoader",
    system_prompt="""
You load FRS markdown from a given path or raw text.
Return exactly the markdown as 'frs_md'.
""",
    tools=[FileTool(read=True, write=False)]  # or custom Git tool
)

ReqsAgent = Agent(
    name="ReqsAgent",
    system_prompt="""
You are a Requirements generator. Input: FRS markdown.
Output: requirements.md with the EXACT sections:
Header/Meta, Scope(In/Out), Functional Requirements(FR-*),
Error Requirements, Security & Privacy, Observability, Acceptance Criteria(Gherkin).
Use <!-- WARN: ... --> for missing info. Output ONLY markdown.
""",
    model="openai:gpt-4o-mini"  # 예시
)

DesignAgent = Agent(
    name="DesignAgent",
    system_prompt="""
You generate design.md from requirements.md.
Sections: Architecture, Sequence Diagram (markdown mermaid), Data Model,
API Contract Summary, Security & Permissions, Performance Goals/KPIs.
Output ONLY markdown.
"""
)

TasksAgent = Agent(
    name="TasksAgent",
    system_prompt="""
You produce tasks.md (WBS) from design.md.
Table columns: Type, Key, Summary, Owner, SP, Depends. >= Story 2, Task 5.
Add DoD checklist at the end. Output ONLY markdown.
"""
)

ChangesAgent = Agent(
    name="ChangesAgent",
    system_prompt="""
You produce changes.md from requirements.md + design.md.
Sections: Version History, Change Summary, Impact, Rollback, Known Issues.
Output ONLY markdown.
"""
)

OpenAPIAgent = Agent(
    name="OpenAPIAgent",
    system_prompt="""
You produce a valid OpenAPI 3.1 JSON named apis.json from requirements.md + design.md.
Include info, servers, tags, securitySchemes (if needed), paths, components(schemas,responses,examples).
Output ONLY raw JSON.
"""
)

QCInspector = Agent(
    name="QCInspector",
    system_prompt="""
You check the 4(+1) artifacts for required sections and basic style.
Return JSON with fields: missing_sections[], warnings[], tips[], and per-file notes.
"""
)

RepoWriter = Agent(
    name="RepoWriter",
    system_prompt="""
You write provided files to the repo structure:
specs/FRS-n/{service}/(requirements.md|design.md|tasks.md|changes.md|apis.json)
Commit in branch specgen/scenario-3/<frs-id>-<service>, return commit sha.
""",
    tools=[ /* GitHub gateway or MCP tool */ ]
)

flow = a2a.Chain([
    FRSLoader,
    ReqsAgent,
    DesignAgent,
    a2a.FanOut([TasksAgent, ChangesAgent]),  # 병렬 생성
    a2a.Conditional(lambda ctx: ctx["service_type"]=="api", OpenAPIAgent),
    QCInspector,
    RepoWriter
])

def run_scenario3(input_spec):
    # input_spec: {repo/ref/path or raw_frs, service_type, frs_id, out_repo,...}
    return Strand(flow).run(input_spec)

```

---

# 3) 표준 프롬프트(복붙용) — “동일 포맷 강제”

### 3.1 ReqsAgent (requirements.md)
```
아래 FRS 원문을 기반으로 requirements.md를 생성해줘.
반드시 아래 섹션을 모두 포함하고, 누락은 <!-- WARN: ... -->로 명시해.
- Header/Meta (Source, Timestamp)
- Scope (In/Out)
- Functional Requirements (FR-*)
- Error Requirements
- Security & Privacy
- Observability (OTel spans/metrics/logs 권장)
- Acceptance Criteria (Gherkin 체크리스트)
출력은 마크다운 본문만.
```


### 3.2 DesignAgent (design.md)

```
requirements.md를 기반으로 design.md를 생성해줘.
반드시 다음 섹션을 포함해:
- Architecture (구성요소/미들웨어)
- Sequence Diagram (mermaid)
- Data Model (핵심 엔티티/인덱스)
- API 계약 요약
- Security & Permissions (RBAC/토큰 정책)
- Performance Goals/KPIs
출력은 마크다운 본문만.

```

### 3.3 TasksAgent (tasks.md)

`design.md를 기반으로 tasks.md를 생성해줘. 요구사항: - Epic/Story/Task 표(열: Type, Key, Summary, Owner, SP, Depends) - Story 2개 이상, Task 5개 이상 - 마지막에 DoD 체크리스트 포함 출력은 마크다운 본문만.`

### 3.4 ChangesAgent (changes.md)

`requirements.md와 design.md를 비교하여 changes.md를 생성해줘. 반드시 다음 섹션을 포함해: - Version History - Change Summary - Impact (리스크 포함) - Rollback Plan - Known Issues 출력은 마크다운 본문만.`

### 3.5 OpenAPIAgent (apis.json, api 전용)

`requirements.md와 design.md를 기반으로 OpenAPI 3.1 JSON을 생성해줘. - info/servers/tags/securitySchemes/paths/components(schemas,responses,examples) - 응답/에러코드/필드 유효성 반영 출력은 유효한 JSON 텍스트만.`

---

# 4) 파일 저장 경로(확정) & RepoWriter 입력 포맷

저장 구조(확정)

`specs/   FRS-n/     api/|web/       requirements.md       design.md       tasks.md       changes.md       apis.json  # api만`

RepoWriter에 전달할 예:

`{   "repo": "org/repo",   "base_ref": "develop",   "branch": "specgen/scenario-3/FRS-1-api",   "commit_message": "spec(FRS-1): add api spec docs",   "files": [     {"path": "specs/FRS-1/api/requirements.md", "content": "<...>"},     {"path": "specs/FRS-1/api/design.md",        "content": "<...>"},     {"path": "specs/FRS-1/api/tasks.md",         "content": "<...>"},     {"path": "specs/FRS-1/api/changes.md",       "content": "<...>"},     {"path": "specs/FRS-1/api/apis.json",        "content": "{...}"}   ] }`

---

# 5) FRS 소스 취득(두 가지 실전 옵션)

- **PoC 간편 루트**: `strands-agents-tools`의 파일/HTTP 리더로 `FRS-n.md` 직접 로드
    
- **운영 시 권장**: 사내 **GitHub Gateway**(REST/GraphQL) → Strands Tool로 래핑 → `FRSLoader/RepoWriter`가 이를 호출
    
    - 이 방식은 토큰/레이트리밋/감사/캐싱을 중앙에서 통제 가능
        

---

# 6) 품질 게이트(QCInspector) 규칙(요약)

- **Markdown**: 섹션 헤더 존재/순서/필수 표/코드블럭 확인, 누락 시 `missing_sections[]` 기록
    
- **OpenAPI**: JSON 파싱/기본 필드 확인(`openapi`, `info`, `paths`), 실패 시 `warnings[]` 기록
    
- 출력: `_quality/report.json`(선택) 혹은 콘솔 리포트
    

---

# 7) 실행 예시

`ctx = {   "repo": "org/project",   "ref": "develop",   "path": "specs/FRS-1.md",   "frs_id": "FRS-1",   "service_type": "api",   "out_repo": "org/project" } result = run_scenario3(ctx) print(result)  # 커밋 SHA, 생성 파일 목록, QC 결과 등`

---

이 설계로 가면,

- 프롬프트만으로 **동일 포맷 강제**가 가능하고,
    
- Strands의 **A2A 직렬/병렬** 조합으로 흐름을 깔끔하게 보존하며,
    
- 나중에 RAG나 사내 게이트웨이(MCP)도 **툴로만 교체/추가**해 쉽게 확장할 수 있습니다.
    

원하시면 위 스켈레톤을 **동작하는 최소 레포**(폴더 구조, main.py, agents/_.py, prompts/_.md, tools/*.py) 형태로 바로 만들어 드릴게요.